<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TDEA - æœƒå“¡æ´»å‹•å°ˆå€</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
    body { font-family: 'Noto Sans TC', sans-serif; background-color: #F4F5F7; margin: 0; }
    * { border-radius: 0 !important; }
    .line-green-bg { background-color: #06C755; }
    .line-green-text { color: #06C755; }
  </style>
</head>
<body class="bg-[#F4F5F7]">
  <nav class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center sticky top-0 z-50">
    <div class="flex items-center space-x-3">
      <div class="w-8 h-8 line-green-bg flex items-center justify-center"><span class="text-white text-xs font-black">TDEA</span></div>
      <span class="font-bold text-gray-800">æœƒå“¡å°ˆå€</span>
    </div>
    <div class="flex items-center space-x-2">
      <span id="userName" class="text-xs font-bold text-gray-500">-</span>
      <img id="userAvatar" class="w-8 h-8 bg-gray-100" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" />
    </div>
  </nav>

  <div class="p-6 space-y-6">
    <div class="bg-white border border-gray-200 p-8 text-center space-y-2 shadow-sm">
      <h2 class="text-xl font-bold text-gray-800">æœ€æ–°æ´»å‹•åˆ—è¡¨</h2>
      <p class="text-xs text-gray-400 uppercase tracking-widest">Ongoing Events</p>
    </div>

    <div id="activityContainer" class="grid grid-cols-1 gap-4">
      <!-- å‹•æ…‹è¼‰å…¥æ´»å‹• -->
      <div class="bg-white border border-gray-200 p-12 text-center text-gray-300 font-bold animate-pulse uppercase tracking-[0.3em]">
        Loading Activities...
      </div>
    </div>
  </div>

  <script>
    const LIFF_ID = "2005868456-Rt5YK7qL";
    const CONFIG = { GAS_URL: window.CRM_CONFIG?.GAS_URL || "" };

    window.onload = async () => {
      // ğŸŒŸ ä¿®æ­£ï¼šå¦‚æœæ²’æœ‰ GAS_URLï¼Œä»£è¡¨åœ¨é–‹ç™¼/é è¦½ç’°å¢ƒï¼Œè·³é LINE é©—è­‰ä»¥é˜²æ­¢é‡å®šå‘éŒ¯èª¤
      if (!CONFIG.GAS_URL || CONFIG.GAS_URL.trim() === "" || CONFIG.GAS_URL.includes("æ‚¨çš„ID")) {
        console.warn("é è¦½æ¨¡å¼ï¼šè·³éèº«åˆ†é©—è­‰æª¢æŸ¥");
        document.getElementById('userName').textContent = "é è¦½ç”¨æˆ¶";
        loadActivities();
        return;
      }

      try {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) { 
          // ç¢ºä¿é‡å®šå‘è·¯å¾‘æ­£ç¢º
          window.location.href = "login.html"; 
          return; 
        }
        const p = await liff.getProfile();
        document.getElementById('userAvatar').src = p.pictureUrl;
        document.getElementById('userName').textContent = p.displayName;

        loadActivities();
      } catch (e) { 
        console.error("LIFF è¼‰å…¥å¤±æ•—:", e);
        // å¦‚æœåœ¨æ­£å¼ç’°å¢ƒä¸­å¤±æ•—ï¼Œä¸”æœ‰è¨­å®š URLï¼Œæ‰å˜—è©¦å›ç™»å…¥é 
        if (CONFIG.GAS_URL) {
          window.location.href = "login.html";
        }
      }
    };

    async function loadActivities() {
      // å¦‚æœæ²’æœ‰å¯¦é«”å¾Œç«¯ï¼Œé¡¯ç¤ºæ¨¡æ“¬è³‡æ–™
      if (!CONFIG.GAS_URL || CONFIG.GAS_URL.trim() === "") {
        const container = document.getElementById('activityContainer');
        container.innerHTML = `
          <div class="bg-white border border-gray-200 p-6 flex justify-between items-center opacity-60">
            <div>
              <div class="text-[10px] font-bold text-gray-400 uppercase mb-1">ç¯„ä¾‹æ´»å‹•</div>
              <div class="text-lg font-bold text-gray-800">TDEA å¹´åº¦å¤§æœƒ (é è¦½)</div>
              <div class="text-xs text-gray-500 mt-1">2024-12-31 14:00</div>
            </div>
            <button class="bg-gray-200 text-gray-400 px-6 py-2 text-xs font-bold" disabled>æŸ¥çœ‹è©³æƒ…</button>
          </div>
          <div class="p-10 text-center text-gray-400 font-bold text-xs uppercase tracking-widest">
            â€” ç›®å‰ç‚ºé è¦½æ¨¡å¼ï¼Œè³‡æ–™åº«æœªé€£ç·š â€”
          </div>
        `;
        return;
      }

      try {
        const res = await fetch(`${CONFIG.GAS_URL}?action=getActivities`).then(r => r.json());
        const container = document.getElementById('activityContainer');
        container.innerHTML = "";
        
        if (res.success && res.data && res.data.length > 0) {
          res.data.forEach(act => {
            const card = document.createElement('div');
            card.className = "bg-white border border-gray-200 p-6 flex justify-between items-center hover:border-[#06C755] transition-all cursor-pointer group";
            card.innerHTML = `
              <div>
                <div class="text-[10px] font-bold text-gray-400 uppercase mb-1">${act['æ´»å‹•æ€§è³ª'] || 'ä¸€èˆ¬æ´»å‹•'}</div>
                <div class="text-lg font-bold text-gray-800 group-hover:line-green-text transition-colors">${act['æ´»å‹•åç¨±'] || 'æœªå‘½åæ´»å‹•'}</div>
                <div class="text-xs text-gray-500 mt-1">${act['æ´»å‹•æ™‚é–“'] || ''}</div>
              </div>
              <button class="line-green-bg text-white px-6 py-2 text-xs font-bold shadow-sm active:scale-95 transition-all">æŸ¥çœ‹è©³æƒ…</button>
            `;
            container.appendChild(card);
          });
        } else {
          container.innerHTML = `<div class="bg-white border border-gray-200 p-10 text-center text-gray-400 font-bold uppercase tracking-widest">No Events Found</div>`;
        }
      } catch (err) {
        console.error("è³‡æ–™è¼‰å…¥å¤±æ•—:", err);
        document.getElementById('activityContainer').innerHTML = `<div class="bg-white border border-gray-200 p-10 text-center text-red-400 font-bold">é€£ç·šè³‡æ–™åº«å¤±æ•—</div>`;
      }
    }
  </script>
</body>
</html>
