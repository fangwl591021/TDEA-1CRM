import React, { useState, useEffect } from 'react';
import { 
  LayoutDashboard, 
  Users, 
  CalendarDays, 
  CheckSquare, 
  Settings, 
  Bell, 
  LogOut, 
  Search, 
  Plus,
  ChevronRight,
  MoreVertical,
  UserCheck,
  Smartphone,
  Database,
  Megaphone,
  Hammer,
  CreditCard,
  Trash2
} from 'lucide-react';

/**
 * SportFlow - 管理者後台 (React Preview 版本)
 * 用途：在 Canvas 視窗中即時預覽所有新功能模組
 */

const App = () => {
  const [activeTab, setActiveTab] = useState('dashboard');
  const [isSidebarOpen, setSidebarOpen] = useState(true);

  // 模擬數據
  const stats = [
    { label: '本月報名人數', value: '1,284', change: '+12%', icon: Users },
    { label: '今日預約課程', value: '12', change: '正常', icon: CalendarDays },
    { label: '點名核銷率', value: '94%', change: '+2%', icon: CheckSquare },
  ];

  const renderContent = () => {
    switch (activeTab) {
      case 'dashboard': return <DashboardView stats={stats} />;
      case 'members': return <MemberManagement />;
      case 'courses': return <CourseManagement />;
      case 'checkin': return <AttendanceCheckIn />;
      case 'announcements': return <AnnouncementManagement />;
      case 'equipment': return <EquipmentManagement />;
      case 'settings': return <SystemSettings />;
      default: return <DashboardView stats={stats} />;
    }
  };

  return (
    <div className="flex h-screen bg-gray-100 text-gray-800 font-sans">
      {/* 左側導航欄 (Sidebar) */}
      <aside className={`${isSidebarOpen ? 'w-64' : 'w-20'} bg-[#2c3e50] text-white transition-all duration-300 flex flex-col shadow-xl z-20`}>
        <div className="p-6 flex items-center gap-3 border-b border-gray-700">
            <div className="w-8 h-8 bg-[#06C755] rounded-lg flex items-center justify-center font-bold text-white shadow-lg">S</div>
            {isSidebarOpen && <span className="font-bold text-xl tracking-tighter uppercase italic">SportFlow</span>}
        </div>

        <nav className="flex-1 mt-4 overflow-y-auto no-scrollbar">
          <NavItem icon={<LayoutDashboard size={20} />} label="數據概覽" active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} collapsed={!isSidebarOpen} />
          <NavItem icon={<Users size={20} />} label="會員管理" active={activeTab === 'members'} onClick={() => setActiveTab('members')} collapsed={!isSidebarOpen} />
          <NavItem icon={<CalendarDays size={20} />} label="課程建置" active={activeTab === 'courses'} onClick={() => setActiveTab('courses')} collapsed={!isSidebarOpen} />
          <NavItem icon={<CheckSquare size={20} />} label="核銷點名" active={activeTab === 'checkin'} onClick={() => setActiveTab('checkin')} collapsed={!isSidebarOpen} />
          
          <div className="border-t border-gray-700 my-2 mx-4"></div>
          
          <NavItem icon={<Megaphone size={20} className="text-amber-400" />} label="公告管理" active={activeTab === 'announcements'} onClick={() => setActiveTab('announcements')} collapsed={!isSidebarOpen} />
          <NavItem icon={<Hammer size={20} className="text-blue-300" />} label="設備管理" active={activeTab === 'equipment'} onClick={() => setActiveTab('equipment')} collapsed={!isSidebarOpen} />
          <NavItem icon={<Settings size={20} />} label="系統設置" active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} collapsed={!isSidebarOpen} />
        </nav>
      </aside>

      <main className="flex-1 flex flex-col overflow-hidden relative">
        <header className="h-16 bg-white shadow-sm flex items-center justify-between px-8 z-10 border-b">
          <div className="flex items-center gap-4">
            <button onClick={() => setSidebarOpen(!isSidebarOpen)} className="p-2 hover:bg-gray-100 rounded-md lg:hidden"><Smartphone size={20} /></button>
            <h2 className="text-xl font-bold text-gray-700 uppercase italic tracking-widest">SportFlow Portal</h2>
          </div>
          <div className="flex items-center gap-3">
              <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
              <span className="text-sm font-bold text-gray-600">Tony Admin</span>
          </div>
        </header>

        <section className="flex-1 overflow-y-auto p-4 md:p-8 bg-gray-50">
          {renderContent()}
        </section>
      </main>
    </div>
  );
};

const NavItem = ({ icon, label, active, onClick, collapsed }) => (
  <button onClick={onClick} className={`flex items-center gap-4 w-full px-6 py-4 transition-all ${active ? 'bg-[#1a252f] text-[#06C755] border-l-4 border-[#06C755]' : 'text-gray-400 hover:bg-[#34495e] hover:text-white'}`}>
    {icon}{!collapsed && <span className="font-medium whitespace-nowrap">{label}</span>}
  </button>
);

const DashboardView = ({ stats }) => (
  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 animate-in fade-in duration-500">
    {stats.map((item, idx) => (
      <div key={idx} className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-4">
        <div className="p-4 bg-green-50 text-[#06C755] rounded-2xl"><item.icon size={24} /></div>
        <div><p className="text-xs font-bold text-gray-400 uppercase tracking-widest">{item.label}</p><h3 className="text-2xl font-bold mt-1">{item.value}</h3></div>
      </div>
    ))}
  </div>
);

const AnnouncementManagement = () => (
  <div className="space-y-6">
    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
      <h3 className="text-lg font-bold mb-4 flex items-center gap-2 text-amber-500"><Megaphone size={20} /> 發布公告</h3>
      <div className="flex gap-4"><input type="text" placeholder="公告標題..." className="flex-1 p-3 bg-gray-50 border rounded-xl outline-none" /><button className="bg-amber-500 text-white px-8 py-3 rounded-xl font-bold">發布</button></div>
    </div>
    <div className="bg-white rounded-2xl border overflow-hidden"><div className="p-4 bg-gray-50 font-bold text-xs uppercase tracking-widest">Active Announcements</div><div className="p-8 text-center text-gray-400 italic">正在載入公告...</div></div>
  </div>
);

const EquipmentManagement = () => (
  <div className="space-y-6">
    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
      <h3 className="text-lg font-bold mb-4 flex items-center gap-2 text-blue-500"><Hammer size={20} /> 設備新增</h3>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4"><input type="text" placeholder="名稱" className="p-3 bg-gray-50 border rounded-xl" /><input type="number" placeholder="費用" className="p-3 bg-gray-50 border rounded-xl" /><button className="bg-blue-600 text-white rounded-xl font-bold">新增</button></div>
    </div>
  </div>
);

const MemberManagement = () => (
    <div className="bg-white rounded-2xl border overflow-hidden">
        <div className="p-6 border-b flex justify-between items-center"><h3 className="font-bold">會員資料庫</h3><button className="bg-[#06C755] text-white px-4 py-2 rounded-xl text-xs font-bold">新增會員</button></div>
        <div className="p-10 text-center text-gray-400">正在同步 Google Sheets 資料...</div>
    </div>
);

const CourseManagement = () => <div className="p-10 text-center text-gray-400 italic">課程模組載入中...</div>;
const AttendanceCheckIn = () => <div className="p-10 text-center text-gray-400 italic">點名模組載入中...</div>;

const SystemSettings = () => (
  <div className="max-w-2xl bg-white p-8 rounded-2xl shadow-sm border space-y-8">
    <section>
      <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><CreditCard size={20} className="text-orange-500" /> 匯款帳號設定</h3>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4"><input type="text" placeholder="銀行名稱" className="p-3 bg-gray-50 border rounded-xl" /><input type="text" placeholder="戶名" className="p-3 bg-gray-50 border rounded-xl" /><input type="text" placeholder="帳號" className="md:col-span-2 p-3 bg-gray-50 border rounded-xl" /></div>
    </section>
    <button className="w-full py-4 bg-[#2c3e50] text-white rounded-xl font-bold uppercase tracking-widest shadow-xl">儲存系統參數</button>
  </div>
);

export default App;
